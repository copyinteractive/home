<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS Building Escape</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #00ff88;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 10px;
            min-height: 100vh;
            position: relative;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            border: 2px solid #ff4757;
            padding: 15px;
            background: rgba(255, 71, 87, 0.1);
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255, 71, 87, 0.3);
        }

        .title {
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            color: #ff4757;
            text-shadow: 0 0 10px #ff4757;
            margin-bottom: 10px;
        }

        .timer {
            font-size: clamp(1.2rem, 3vw, 1.8rem);
            color: #ffa502;
            font-weight: bold;
            text-shadow: 0 0 10px #ffa502;
            margin-bottom: 10px;
        }

        .timer.danger {
            color: #ff4757;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .floor-indicator {
            background: rgba(0, 255, 136, 0.2);
            border: 1px solid #00ff88;
            padding: 10px;
            border-radius: 5px;
            font-size: clamp(1rem, 2.5vw, 1.3rem);
            margin-bottom: 15px;
        }

        .story-content {
            background: rgba(22, 33, 62, 0.8);
            border: 1px solid #00ff88;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            line-height: 1.4;
            font-size: clamp(1rem, 2.5vw, 1.2rem);
        }

        .story-content h3 {
            color: #ffa502;
            margin-bottom: 10px;
            text-align: center;
            font-size: clamp(1.2rem, 3vw, 1.5rem);
        }

        .choices {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        .choice-btn, .next-btn {
            background: linear-gradient(45deg, #2c5282, #3182ce);
            border: 2px solid #00ff88;
            color: #ffffff;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: clamp(1rem, 2.5vw, 1.1rem);
            font-family: 'Courier New', monospace;
            transition: all 0.3s ease;
            text-align: center;
        }

        .choice-btn:hover, .next-btn:hover {
            background: linear-gradient(45deg, #3182ce, #4299e1);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
            transform: translateY(-2px);
        }

        .next-btn {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            margin-top: 10px;
        }

        .difficulty-btn {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
            border: 2px solid #e74c3c;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: clamp(1.1rem, 2.8vw, 1.3rem);
            font-family: 'Courier New', monospace;
            transition: all 0.3s ease;
            text-align: center;
            margin: 10px 0;
        }

        .difficulty-btn.easy {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            border-color: #00ff88;
        }

        .difficulty-btn.hard {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            border-color: #ff4757;
        }

        .difficulty-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        .warning {
            background: rgba(255, 71, 87, 0.2);
            border: 2px solid #ff4757;
            color: #ff4757;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            animation: flash 2s infinite;
            text-align: center;
            font-weight: bold;
        }

        @keyframes flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .bot-display {
            background: rgba(255, 165, 2, 0.1);
            border: 1px solid #ffa502;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            text-align: center;
        }

        .input-section {
            margin: 15px 0;
            padding: 15px;
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            border-radius: 8px;
        }

        .input-section input {
            width: 100%;
            padding: 12px;
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #00ff88;
            border-radius: 5px;
            color: #00ff88;
            font-family: 'Courier New', monospace;
            margin-bottom: 10px;
            text-align: center;
        }

        .submit-btn {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            border: 2px solid #00ff88;
            color: white;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: clamp(1rem, 2.5vw, 1.1rem);
            font-family: 'Courier New', monospace;
            transition: all 0.3s ease;
            width: 100%;
        }

        .submit-btn:hover {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
        }

        .game-over, .victory {
            background: rgba(255, 71, 87, 0.2);
            border: 3px solid #ff4757;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
        }

        .victory {
            background: rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
        }

        .restart-btn {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            border: 2px solid #ff4757;
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            font-family: 'Courier New', monospace;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .restart-btn:hover {
            background: linear-gradient(45deg, #c0392b, #e74c3c);
            box-shadow: 0 0 20px rgba(255, 71, 87, 0.5);
        }

        @media (max-width: 600px) {
            .container {
                padding: 5px;
            }
            
            .header {
                padding: 10px;
            }
            
            .story-content {
                padding: 12px;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">üö® NEXUS BUILDING ESCAPE üö®</h1>
            <div class="timer" id="timer" style="display: none;">TIME: 5:00</div>
            <div class="floor-indicator" id="floor-indicator" style="display: none;">FLOOR 5</div>
        </div>

        <div id="game-content">
            <!-- Game content will be inserted here -->
        </div>
    </div>

    <script>
        let timeLeft = 300;
        let gameRunning = false;
        let timerInterval;
        let gameMode = 'easy';
        let timerStarted = false;
        let currentEvacCode;
        let currentScenario;

        // 5 different evacuation scenarios
        const scenarios = [
            {
                code: 26,
                floor5: { easy: '101', hard: '4' },
                floor4: { easy: '122', hard: '31' },
                floor3: { easy: '222', hard: '211' },
                floor2: { easy: '11010', hard: '11110' },
                floor1: { bot1: '11010', bot2: '10101', sum: '47' }
            },
            {
                code: 42,
                floor5: { easy: '132', hard: '13' },
                floor4: { easy: '222', hard: '110' },
                floor3: { easy: '1120', hard: '102' },
                floor2: { easy: '101010', hard: '110100' },
                floor1: { bot1: '101010', bot2: '110011', sum: '81' }
            },
            {
                code: 63,
                floor5: { easy: '223', hard: '23' },
                floor4: { easy: '333', hard: '213' },
                floor3: { easy: '2100', hard: '120' },
                floor2: { easy: '111111', hard: '101111' },
                floor1: { bot1: '111111', bot2: '100101', sum: '108' }
            },
            {
                code: 31,
                floor5: { easy: '111', hard: '11' },
                floor4: { easy: '133', hard: '133' },
                floor3: { easy: '1011', hard: '101' },
                floor2: { easy: '11111', hard: '10011' },
                floor1: { bot1: '11111', bot2: '11001', sum: '56' }
            },
            {
                code: 58,
                floor5: { easy: '213', hard: '43' },
                floor4: { easy: '322', hard: '130' },
                floor3: { easy: '2011', hard: '112' },
                floor2: { easy: '111010', hard: '111000' },
                floor1: { bot1: '111010', bot2: '101101', sum: '103' }
            }
        ];

        function getRandomScenario() {
            return scenarios[Math.floor(Math.random() * scenarios.length)];
        }

        function startTimer() {
            if (!timerStarted) {
                timerStarted = true;
                gameRunning = true;
                document.getElementById('timer').style.display = 'block';
                document.getElementById('floor-indicator').style.display = 'block';
                
                timerInterval = setInterval(() => {
                    if (!gameRunning) return;
                    
                    timeLeft--;
                    updateTimerDisplay();
                    
                    if (timeLeft <= 0) {
                        gameOver();
                    }
                }, 1000);
            }
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timerElement = document.getElementById('timer');
            timerElement.textContent = `TIME: ${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            if (timeLeft <= 60) {
                timerElement.classList.add('danger');
            }
        }

        function updateFloorIndicator(floor, base) {
            const indicator = document.getElementById('floor-indicator');
            if (gameMode === 'easy') {
                indicator.textContent = `FLOOR ${floor} - BASE ${base}`;
            } else {
                indicator.textContent = `FLOOR ${floor} - BASE ${base} (HARD MODE)`;
            }
        }

        function showContent(content) {
            document.getElementById('game-content').innerHTML = content;
        }

        function loseTime() {
            timeLeft -= 30;
            if (timeLeft < 0) timeLeft = 0;
            updateTimerDisplay();
        }

        function gameOver(message = "Time's up! The robots captured you and locked you up in their secret room. You can no longer escape.") {
            gameRunning = false;
            clearInterval(timerInterval);
            showContent(`
                <div class="game-over">
                    <h3>GAME OVER</h3>
                    <p>${message}</p>
                    <p>Evacuation Code: ${currentEvacCode}</p>
                    <p>You reached floor ${6 - Math.floor((300 - timeLeft)/60)}</p>
                    <button class="restart-btn" onclick="restartGame()">TRY AGAIN</button>
                </div>
            `);
        }

        function victory() {
            gameRunning = false;
            clearInterval(timerInterval);
            showContent(`
                <div class="victory">
                    <h3>üéâ ESCAPE SUCCESSFUL! üéâ</h3>
                    <p>You escaped the building with ${Math.floor(timeLeft/60)}:${(timeLeft%60).toString().padStart(2, '0')} remaining!</p>
                    <p>Evacuation Code: ${currentEvacCode}</p>
                    <p>Your classmates cheer as you emerge from the building!</p>
                    <button class="restart-btn" onclick="restartGame()">PLAY AGAIN</button>
                </div>
            `);
        }

        function restartGame() {
            timeLeft = 300;
            gameRunning = false;
            timerStarted = false;
            currentScenario = getRandomScenario();
            currentEvacCode = currentScenario.code;
            document.getElementById('timer').classList.remove('danger');
            document.getElementById('timer').style.display = 'none';
            document.getElementById('floor-indicator').style.display = 'none';
            startGame();
        }

        // Story progression
        function startGame() {
            currentScenario = getRandomScenario();
            currentEvacCode = currentScenario.code;
            showContent(`
                <div class="story-content">
                    <h3>GHC Excursion</h3>
                    <p>You are in the bathroom during GHC's excursion to an AI company in Ibadan.</p>
                    <p>Suddenly you hear the loud emergency siren screaming everywhere.</p>
                </div>
                <button class="next-btn" onclick="showBathroom()">Rush out of the bathroom</button>
            `);
        }

        function showBathroom() {
            showContent(`
                <div class="story-content">
                    <h3>Where is everyone?</h3>
                    <p>You quickly leave the bathroom to find your classmates or Mr Umolu.</p>
                    <p>None of them is there. It appears everyone has left the fifth floor.</p>
                    <p>Ahead, you see a big screen with some information.</p>
                </div>
                <button class="next-btn" onclick="showScreen()">Go to the screen</button>
            `);
        }

        function showScreen() {
            showContent(`
                <div class="story-content">
                    <p>The big screen displays:</p>
                    <div class="warning">
                        SYSTEM ERROR<br>
                        ROBOTS OUT OF CONTROL<br>
                        GET TO SAFETY NOW<br>
                        YOU HAVE 5 MINUTES
                    </div>
                    <p>You remember what the guide told you:</p>
                    <p>Each floor is a base number. To unlock the door to the stairs, you must convert the displayed code to the base of your floor.</p>
                    <div class="warning">
                        EVACUATION CODE: ${currentEvacCode}<br>
                        ELEVATORS: OFFLINE<br>
                        STAIRS: LOCKED
                    </div>
                </div>
                <button class="next-btn" onclick="chooseDifficulty()">SELECT DIFFICULTY</button>
            `);
        }

        function chooseDifficulty() {
            showContent(`
                <div class="story-content">
                    <h3>Choose Your Challenge</h3>
                    <p>How confident are you with base conversions?</p>
                </div>
                <div class="choices">
                    <button class="difficulty-btn easy" onclick="setDifficulty('easy')">üü¢ EASY MODE<br><small>Standard base conversions</small></button>
                    <button class="difficulty-btn hard" onclick="setDifficulty('hard')">üî¥ HARD MODE<br><small>Complex calculations</small></button>
                </div>
            `);
        }

        function setDifficulty(mode) {
            gameMode = mode;
            startTimer();
            showFloor5Intro();
        }

        function showFloor5Intro() {
            updateFloorIndicator(5, 5);
            showContent(`
                <div class="story-content">
                    <h3>Floor 5: Escape Begins!</h3>
                    <p>You're on Floor 5. The door requires base-5 conversion!</p>
                    <p>Convert <strong>${currentEvacCode}</strong> to base-5 to unlock the stairs DOWN!</p>
                </div>
                <button class="next-btn" onclick="showFloor5()">START CONVERSION</button>
            `);
        }

        // Floor 5
        function showFloor5() {
            if (gameMode === 'easy') {
                const answers = [
                    currentScenario.floor5.easy,
                    generateWrongAnswer(currentScenario.floor5.easy, 5),
                    generateWrongAnswer(currentScenario.floor5.easy, 5)
                ];
                shuffleArray(answers);
                
                showContent(`
                    <div class="story-content">
                        <h3>Base-5 Challenge</h3>
                        <p><strong>Door Display:</strong> "ENTER ${currentEvacCode} IN BASE-5"</p>
                    </div>
                    <div class="choices">
                        <button class="choice-btn" onclick="checkFloor5Answer('${answers[0]}')">${answers[0]}</button>
                        <button class="choice-btn" onclick="checkFloor5Answer('${answers[1]}')">${answers[1]}</button>
                        <button class="choice-btn" onclick="checkFloor5Answer('${answers[2]}')">${answers[2]}</button>
                    </div>
                `);
            } else {
                showContent(`
                    <div class="story-content">
                        <h3>Advanced Base-5 Challenge</h3>
                        <p><strong>Door Display:</strong> "SOLVE: (3 √ó ${currentEvacCode} + 17) √∑ 5 - 15, THEN CONVERT RESULT TO BASE-5"</p>
                    </div>
                    <div class="input-section">
                        <input type="text" id="floor5hard" placeholder="Enter final answer in base-5" maxlength="8">
                        <button class="submit-btn" onclick="checkFloor5Hard()">SUBMIT ANSWER</button>
                    </div>
                `);
            }
        }

        function checkFloor5Answer(answer) {
            if (answer === currentScenario.floor5.easy) {
                showFloor5Success();
            } else {
                loseTime();
                showFloor5Wrong();
            }
        }

        function checkFloor5Hard() {
            const answer = document.getElementById('floor5hard').value.trim();
            if (answer === currentScenario.floor5.hard) {
                showFloor5Success();
            } else {
                loseTime();
                showFloor5Wrong();
            }
        }

        function showFloor5Success() {
            showContent(`
                <div class="story-content">
                    <h3>‚úÖ Correct!</h3>
                    <p>The door clicks open! You rush down the stairs!</p>
                </div>
                <button class="next-btn" onclick="showFloor4Intro()">CONTINUE TO FLOOR 4</button>
            `);
        }

        function showFloor5Wrong() {
            showContent(`
                <div class="story-content">
                    <div class="warning">‚ùå WRONG! DOOR LOCKED!</div>
                    <p>You lost 30 seconds! Mechanical footsteps approach...</p>
                </div>
                <button class="next-btn" onclick="showBots5()">DEFEND YOURSELF!</button>
            `);
        }

        function showBots5() {
            showContent(`
                <div class="story-content">
                    <h3>ü§ñ Bot Attack!</h3>
                    <div class="bot-display">
                        Red Bot: 1010<br>
                        Blue Bot: 1101<br>
                        Different colors = SUBTRACT!
                    </div>
                </div>
                <div class="input-section">
                    <input type="text" id="bot5" placeholder="1101 - 1010 = ?" maxlength="8">
                    <button class="submit-btn" onclick="checkBots5()">DEFEAT BOTS</button>
                </div>
            `);
        }

        function checkBots5() {
            const answer = document.getElementById('bot5').value.trim();
            if (answer === '0011' || answer === '11') {
                showContent(`
                    <div class="story-content">
                        <h3>üéØ Bots Defeated!</h3>
                        <p>Your remote zaps them! Door unlocks!</p>
                    </div>
                    <button class="next-btn" onclick="showFloor4Intro()">TO FLOOR 4</button>
                `);
            } else {
                gameOver("The robots captured you and locked you up in their secret room. You can no longer escape.");
            }
        }

        function showFloor4Intro() {
            updateFloorIndicator(4, 4);
            showContent(`
                <div class="story-content">
                    <h3>Floor 4</h3>
                    <p>Base-4 door ahead! You hear more bots approaching!</p>
                    <p>Convert <strong>${currentEvacCode}</strong> to base-4 to proceed!</p>
                </div>
                <button class="next-btn" onclick="showFloor4()">FACE THE CHALLENGE</button>
            `);
        }

        function showFloor4() {
            if (gameMode === 'easy') {
                showContent(`
                    <div class="story-content">
                        <h3>Base-4 Challenge</h3>
                        <p>Door needs: ${currentEvacCode} in base-4</p>
                        <div class="bot-display">
                            Green Bot 1: 1100<br>
                            Green Bot 2: 1001<br>
                            Same color = ADD!
                        </div>
                    </div>
                    <div class="input-section">
                        <input type="text" id="door4" placeholder="${currentEvacCode} in base-4">
                        <input type="text" id="bot4" placeholder="1100 + 1001">
                        <button class="submit-btn" onclick="checkFloor4()">SUBMIT BOTH</button>
                    </div>
                `);
            } else {
                showContent(`
                    <div class="story-content">
                        <h3>Advanced Base-4 Challenge</h3>
                        <p>Door needs: Convert (${currentEvacCode}¬≤ - ${currentEvacCode * 25}) √∑ 2 to base-4</p>
                        <div class="bot-display">
                            Complex Bot Calculation:<br>
                            Purple Bot: 10110<br>
                            Yellow Bot: 11010<br>
                            Different colors = SUBTRACT!
                        </div>
                    </div>
                    <div class="input-section">
                        <input type="text" id="door4hard" placeholder="Final answer in base-4">
                        <input type="text" id="bot4hard" placeholder="10110 - 11010 (in binary)">
                        <button class="submit-btn" onclick="checkFloor4Hard()">SUBMIT BOTH</button>
                    </div>
                `);
            }
        }

        function checkFloor4() {
            const door = document.getElementById('door4').value.trim();
            const bot = document.getElementById('bot4').value.trim();
            if (door === currentScenario.floor4.easy && (bot === '10101' || bot === '010101')) {
                showFloor4Success();
            } else {
                loseTime();
                showFloor4Wrong();
            }
        }

        function checkFloor4Hard() {
            const door = document.getElementById('door4hard').value.trim();
            const bot = document.getElementById('bot4hard').value.trim();
            if (door === currentScenario.floor4.hard && (bot === '-100' || bot === '100' || bot === '-0100')) {
                showFloor4Success();
            } else {
                loseTime();
                showFloor4Wrong();
            }
        }

        function showFloor4Success() {
            showContent(`
                <div class="story-content">
                    <h3>‚úÖ Correct!</h3>
                    <p>The door unlocks and you descend to Floor 3!</p>
                </div>
                <button class="next-btn" onclick="showFloor3Intro()">CONTINUE TO FLOOR 3</button>
            `);
        }

        function showFloor4Wrong() {
            showContent(`
                <div class="story-content">
                    <div class="warning">‚ùå WRONG! DOOR LOCKED!</div>
                    <p>You lost 30 seconds! The bots are getting closer...</p>
                </div>
                <button class="next-btn" onclick="showBots4()">DEFEND YOURSELF!</button>
            `);
        }

        function showBots4() {
            showContent(`
                <div class="story-content">
                    <h3>ü§ñ Bot Attack!</h3>
                    <div class="bot-display">
                        Floor 4 Security Question:<br>
                        What is ${currentEvacCode} in hexadecimal?
                    </div>
                </div>
                <div class="input-section">
                    <input type="text" id="bot4" placeholder="Enter hexadecimal value">
                    <button class="submit-btn" onclick="checkBots4()">DEFEAT BOTS</button>
                </div>
            `);
        }

        function checkBots4() {
            const hexAnswer = currentEvacCode.toString(16).toLowerCase();
            const answer = document.getElementById('bot4').value.trim().toLowerCase();
            if (answer === hexAnswer) {
                showContent(`
                    <div class="story-content">
                        <h3>üéØ Bots Defeated!</h3>
                        <p>Your quick thinking disables them! Door unlocks!</p>
                    </div>
                    <button class="next-btn" onclick="showFloor3Intro()">TO FLOOR 3</button>
                `);
            } else {
                gameOver("The robots captured you and locked you up in their secret room. You can no longer escape.");
            }
        }

        function showFloor3Intro() {
            updateFloorIndicator(3, 3);
            showContent(`
                <div class="story-content">
                    <h3>Floor 3</h3>
                    <p>You reach Floor 3. The door panel shows a base-3 challenge.</p>
                    <p>Convert ${currentEvacCode} to base-3 to proceed!</p>
                </div>
                <button class="next-btn" onclick="showFloor3()">FACE THE CHALLENGE</button>
            `);
        }

        function showFloor3() {
            if (gameMode === 'easy') {
                const answers = [
                    currentScenario.floor3.easy,
                    generateWrongAnswer(currentScenario.floor3.easy, 3),
                    generateWrongAnswer(currentScenario.floor3.easy, 3)
                ];
                shuffleArray(answers);
                
                showContent(`
                    <div class="story-content">
                        <h3>Base-3 Challenge</h3>
                        <p>Door needs: ${currentEvacCode} in base-3</p>
                    </div>
                    <div class="choices">
                        <button class="choice-btn" onclick="checkFloor3Answer('${answers[0]}')">${answers[0]}</button>
                        <button class="choice-btn" onclick="checkFloor3Answer('${answers[1]}')">${answers[1]}</button>
                        <button class="choice-btn" onclick="checkFloor3Answer('${answers[2]}')">${answers[2]}</button>
                    </div>
                `);
            } else {
                showContent(`
                    <div class="story-content">
                        <h3>Advanced Base-3 Challenge</h3>
                        <p>Door needs: Convert (${currentEvacCode} √ó 3 + 10) √∑ 4 to base-3</p>
                    </div>
                    <div class="input-section">
                        <input type="text" id="floor3hard" placeholder="Final answer in base-3">
                        <button class="submit-btn" onclick="checkFloor3Hard()">SUBMIT ANSWER</button>
                    </div>
                `);
            }
        }

        function checkFloor3Answer(answer) {
            if (answer === currentScenario.floor3.easy) {
                showFloor3Success();
            } else {
                loseTime();
                showFloor3Wrong();
            }
        }

        function checkFloor3Hard() {
            const answer = document.getElementById('floor3hard').value.trim();
            if (answer === currentScenario.floor3.hard) {
                showFloor3Success();
            } else {
                loseTime();
                showFloor3Wrong();
            }
        }

        function showFloor3Success() {
            showContent(`
                <div class="story-content">
                    <h3>‚úÖ Correct!</h3>
                    <p>The door unlocks! You descend to Floor 2!</p>
                </div>
                <button class="next-btn" onclick="showFloor2Intro()">CONTINUE TO FLOOR 2</button>
            `);
        }

        function showFloor3Wrong() {
            showContent(`
                <div class="story-content">
                    <div class="warning">‚ùå WRONG! DOOR LOCKED!</div>
                    <p>You lost 30 seconds! The security system activates...</p>
                </div>
                <button class="next-btn" onclick="showBots3()">DEFEND YOURSELF!</button>
            `);
        }

        function showBots3() {
            showContent(`
                <div class="story-content">
                    <h3>ü§ñ Bot Attack!</h3>
                    <div class="bot-display">
                        Floor 3 Security Question:<br>
                        What is the binary representation of ${currentEvacCode}?
                    </div>
                </div>
                <div class="input-section">
                    <input type="text" id="bot3" placeholder="Enter binary value">
                    <button class="submit-btn" onclick="checkBots3()">DEFEAT BOTS</button>
                </div>
            `);
        }

        function checkBots3() {
            const binaryAnswer = currentEvacCode.toString(2);
            const answer = document.getElementById('bot3').value.trim();
            if (answer === binaryAnswer) {
                showContent(`
                    <div class="story-content">
                        <h3>üéØ Bots Defeated!</h3>
                        <p>Your quick thinking disables them! Door unlocks!</p>
                    </div>
                    <button class="next-btn" onclick="showFloor2Intro()">TO FLOOR 2</button>
                `);
            } else {
                gameOver("The robots captured you and locked you up in their secret room. You can no longer escape.");
            }
        }

        function showFloor2Intro() {
            updateFloorIndicator(2, 2);
            showContent(`
                <div class="story-content">
                    <h3>Floor 2</h3>
                    <p>You reach Floor 2. The door panel shows a base-2 challenge.</p>
                    <p>Convert ${currentEvacCode} to binary to proceed!</p>
                </div>
                <button class="next-btn" onclick="showFloor2()">FACE THE CHALLENGE</button>
            `);
        }

        function showFloor2() {
            if (gameMode === 'easy') {
                const answers = [
                    currentScenario.floor2.easy,
                    generateWrongAnswer(currentScenario.floor2.easy, 2),
                    generateWrongAnswer(currentScenario.floor2.easy, 2)
                ];
                shuffleArray(answers);
                
                showContent(`
                    <div class="story-content">
                        <h3>Binary Challenge</h3>
                        <p>Door needs: ${currentEvacCode} in binary</p>
                    </div>
                    <div class="choices">
                        <button class="choice-btn" onclick="checkFloor2Answer('${answers[0]}')">${answers[0]}</button>
                        <button class="choice-btn" onclick="checkFloor2Answer('${answers[1]}')">${answers[1]}</button>
                        <button class="choice-btn" onclick="checkFloor2Answer('${answers[2]}')">${answers[2]}</button>
                    </div>
                `);
            } else {
                showContent(`
                    <div class="story-content">
                        <h3>Advanced Binary Challenge</h3>
                        <p>Door needs: Binary representation of (${currentEvacCode} √ó 5 - 100)</p>
                    </div>
                    <div class="input-section">
                        <input type="text" id="floor2hard" placeholder="Enter binary value">
                        <button class="submit-btn" onclick="checkFloor2Hard()">SUBMIT ANSWER</button>
                    </div>
                `);
            }
        }

        function checkFloor2Answer(answer) {
            if (answer === currentScenario.floor2.easy) {
                showFloor2Success();
            } else {
                loseTime();
                showFloor2Wrong();
            }
        }

        function checkFloor2Hard() {
            const answer = document.getElementById('floor2hard').value.trim();
            if (answer === currentScenario.floor2.hard) {
                showFloor2Success();
            } else {
                loseTime();
                showFloor2Wrong();
            }
        }

        function showFloor2Success() {
            showContent(`
                <div class="story-content">
                    <h3>‚úÖ Correct!</h3>
                    <p>The door unlocks! You descend to the final floor!</p>
                </div>
                <button class="next-btn" onclick="showFloor1Intro()">CONTINUE TO FLOOR 1</button>
            `);
        }

        function showFloor2Wrong() {
            showContent(`
                <div class="story-content">
                    <div class="warning">‚ùå WRONG! DOOR LOCKED!</div>
                    <p>You lost 30 seconds! Security bots are closing in...</p>
                </div>
                <button class="next-btn" onclick="showBots2()">DEFEND YOURSELF!</button>
            `);
        }

        function showBots2() {
            showContent(`
                <div class="story-content">
                    <h3>ü§ñ Final Bot Attack!</h3>
                    <div class="bot-display">
                        Final Security Question:<br>
                        What is ${currentEvacCode} in octal (base-8)?
                    </div>
                </div>
                <div class="input-section">
                    <input type="text" id="bot2" placeholder="Enter octal value">
                    <button class="submit-btn" onclick="checkBots2()">DEFEAT BOTS</button>
                </div>
            `);
        }

        function checkBots2() {
            const octalAnswer = currentEvacCode.toString(8);
            const answer = document.getElementById('bot2').value.trim();
            if (answer === octalAnswer) {
                showContent(`
                    <div class="story-content">
                        <h3>üéØ Bots Defeated!</h3>
                        <p>Your quick thinking disables them! Door unlocks!</p>
                    </div>
                    <button class="next-btn" onclick="showFloor1Intro()">TO FLOOR 1</button>
                `);
            } else {
                gameOver("The robots captured you and locked you up in their secret room. You can no longer escape.");
            }
        }

        function showFloor1Intro() {
            updateFloorIndicator(1, 10);
            showContent(`
                <div class="story-content">
                    <h3>Floor 1 - Final Challenge!</h3>
                    <p>You reach the ground floor! The exit is just ahead!</p>
                    <p>Two security bots block your path. You must defeat them to escape!</p>
                </div>
                <button class="next-btn" onclick="showFloor1()">FACE FINAL CHALLENGE</button>
            `);
        }

        function showFloor1() {
            showContent(`
                <div class="story-content">
                    <h3>Final Escape Challenge</h3>
                    <p>The exit door requires a base-10 code.</p>
                    <p>Two security bots approach with binary numbers:</p>
                    <div class="bot-display">
                        Alpha Bot: ${currentScenario.floor1.bot1} (${parseInt(currentScenario.floor1.bot1, 2)} in binary)<br>
                        Beta Bot: ${currentScenario.floor1.bot2} (${parseInt(currentScenario.floor1.bot2, 2)} in binary)
                    </div>
                    <p>Add the two binary numbers together, then convert the sum to base-10.</p>
                    <p>This will be your final escape code!</p>
                </div>
                <div class="input-section">
                    <input type="text" id="finalCode" placeholder="Enter sum in base-10">
                    <button class="submit-btn" onclick="checkFinalCode()">SUBMIT ESCAPE CODE</button>
                </div>
            `);
        }

        function checkFinalCode() {
            const answer = document.getElementById('finalCode').value.trim();
            if (answer === currentScenario.floor1.sum) {
                victory();
            } else {
                loseTime();
                showFloor1Wrong();
            }
        }

        function showFloor1Wrong() {
            // Generate new bot numbers for the second chance
            const newBot1 = (currentEvacCode + 4).toString(2);
            const newBot2 = (currentEvacCode - 12).toString(2);
            const newSum = (parseInt(newBot1, 2) + parseInt(newBot2, 2)).toString();
            
            showContent(`
                <div class="story-content">
                    <div class="warning">‚ùå WRONG CODE!</div>
                    <p>You lost 30 seconds! The security system is about to lock down completely!</p>
                    <p>The bots regenerate with new numbers:</p>
                    <div class="bot-display">
                        Alpha Bot: ${newBot1} (${parseInt(newBot1, 2)} in binary)<br>
                        Beta Bot: ${newBot2} (${parseInt(newBot2, 2)} in binary)
                    </div>
                </div>
                <div class="input-section">
                    <input type="text" id="finalBot" placeholder="Enter sum in base-10">
                    <button class="submit-btn" onclick="checkFinalBots('${newSum}')">SUBMIT FINAL ANSWER</button>
                </div>
            `);
        }

        function checkFinalBots(correctAnswer) {
            const answer = document.getElementById('finalBot').value.trim();
            if (answer === correctAnswer) {
                victory();
            } else {
                gameOver("The robots captured you and locked you up in their secret room. You can no longer escape.");
            }
        }

        // Utility functions
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function generateWrongAnswer(correctAnswer, base) {
            let wrongAnswer;
            do {
                if (base === 2) {
                    // For binary, flip some bits
                    wrongAnswer = correctAnswer.split('').map(bit => 
                        Math.random() > 0.7 ? (bit === '1' ? '0' : '1') : bit
                    ).join('');
                } else {
                    // For other bases, modify digits
                    wrongAnswer = correctAnswer.split('').map(digit => {
                        if (Math.random() > 0.7) {
                            const newDigit = Math.floor(Math.random() * base);
                            return newDigit.toString();
                        }
                        return digit;
                    }).join('');
                }
            } while (wrongAnswer === correctAnswer || wrongAnswer === '');
            
            return wrongAnswer;
        }

        // Start the game when page loads
        window.onload = startGame;
    </script>
</body>
</html>
